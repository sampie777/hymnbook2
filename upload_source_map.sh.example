#!/bin/bash.
SERVERKEY=""
VERSION=$(sed 's/.*"version": "\(.*\)".*/\1/;t;d' ./package.json)

# Create source map
echo Creating source map
react-native bundle --platform android --dev false --entry-file index.js --bundle-output android/index.android.bundle --assets-dest android/app/src/main/res/ --sourcemap-output sourcemap.android.js --sourcemap-sources-root ./

# Upload source map
echo Uploading source map
curl https://api.rollbar.com/api/1/sourcemap \
-F access_token=${SERVERKEY} \
-F version=${VERSION} \
-F minified_url=http://reactnativehost/index.android.bundle \
-F source_map=@sourcemap.android.js \
-F index.js=@index.js

# Remove duplicates
echo Remove duplicate files
rm -rf android/app/src/main/res/drawable-hdpi/
rm -rf android/app/src/main/res/drawable-mdpi/
rm -rf android/app/src/main/res/drawable-xhdpi/
rm -rf android/app/src/main/res/drawable-xxhdpi/
rm -rf android/app/src/main/res/drawable-xxxhdpi/
rm -rf android/app/src/main/res/raw/
